// (c)2009 The Wojo Group / Brett Wejrowski

var a,NextId=1,Custom="Custom",GoogleCheckout="GoogleCheckout",PayPal="PayPal",Email="Email",AustralianDollar=AUD="AUD",CanadianDollar=CAD="CAD",CzechKoruna=CZK="CZK",DanishKrone=DKK="DKK",Euro=EUR="EUR",HongKongDollar=HKD="HKD",HungarianForint=HUF="HUF",IsraeliNewSheqel=ILS="ILS",JapaneseYen=JPY="JPY",MexicanPeso=MXN="MXN",NorwegianKrone=NOK="NOK",NewZealandDollar=NZD="NZD",PolishZloty=PLN="PLN",PoundSterling=GBP="GBP",SingaporeDollar=SGD="SGD",SwedishKrona=SEK="SEK",SwissFranc=CHF="CHF",USDollar=
USD="USD";
function Cart(){var b=this;b.Version="2.0.1";b.Shelf=new Shelf;b.items={};b.isLoaded=false;b.pageIsReady=false;b.quantity=0;b.total=0;b.taxRate=0;b.taxCost=0;b.shippingFlatRate=0;b.shippingTotalRate=0;b.shippingQuantityRate=0;b.shippingRate=0;b.shippingCost=0;b.currency=USD;b.checkoutTo=PayPal;b.email="";b.merchantId="";b.cartHeaders=["Name","Price","Quantity","Total"];b.add=function(){var c=this;if(!c.pageIsReady){c.initializeView();c.update()}if(!c.isLoaded){c.load();c.update()}var d=new CartItem;
if(!arguments||arguments.length===0)error("No values passed for item.");else{var e=arguments;if(arguments[0]&&typeof arguments[0]!="string"&&typeof arguments[0]!="number")e=arguments[0];d.parseValuesFromArray(e);d.checkQuantityAndPrice();if(c.hasItem(d)){e=c.hasItem(d);c.items[e].quantity=parseInt(c.items[e].quantity,10)+parseInt(d.quantity,10)}else c.items[d.id]=d;c.update()}};b.remove=function(c){var d={};for(var e in this.items)if(e!=c)d[e]=this.items[e];this.items=d};b.empty=function(){simpleCart.items=
{};simpleCart.update()};b.find=function(c){if(!c)return null;var d=[];for(var e in b.items){var g=b.items[e],f=true;for(var i in c)if(!g[i]||g[i]!=c[i])f=false;f&&d.push(b.next)}return d.length==0?null:d};b.checkout=function(){if(simpleCart.quantity===0)error("Cart is empty");else switch(simpleCart.checkoutTo){case PayPal:simpleCart.paypalCheckout();break;case GoogleCheckout:simpleCart.googleCheckout();break;case Email:simpleCart.emailCheckout();break;default:simpleCart.customCheckout();break}};b.paypalCheckout=
function(){var c="scrollbars,location,resizable,status",d="https://www.paypal.com/cgi-bin/webscr?cmd=_cart&upload=1&business="+f.email+"&currency_code="+f.currency,e=1,g="",f=this;if(f.taxRate)d=d+"&tax_cart="+f.currencyStringForPaypalCheckout(f.taxCost);for(var i in f.items){var h=f.items[i],k="";for(var j in h)if(typeof h[j]!="function"&&j!="id"&&j!="price"&&j!="quantity"&&j!="name"&&j!="shipping")k=k+", "+j+"="+h[j];k=k.substring(2);g=g+"&item_name_"+e+"="+h.name+"&item_number_"+e+"="+e+"&quantity_"+
e+"="+h.quantity+"&amount_"+e+"="+f.currencyStringForPaypalCheckout(h.price)+"&on0_"+e+"=Options&os0_"+e+"="+k;e++}if(f.shipping()!=0)g=g+"&item_name_"+e+"=Shipping&item_number_"+e+"="+e+"&quantity_"+e+"=1&amount_"+e+"="+f.currencyStringForPaypalCheckout(f.shippingCost);d+=g;window.open(d,"paypal",c)};b.googleCheckout=function(){var c=this;if(c.currency!=USD&&c.currency!=GBP)error("Google Checkout only allows the USD and GBP for currency.");else if(c.merchantId===""||c.merchantId===null||!c.merchantId)error("No merchant Id for google checkout supplied.");
else{var d=document.createElement("form"),e=1;d.style.display="none";d.method="POST";d.action="https://checkout.google.com/api/checkout/v2/checkoutForm/Merchant/"+c.merchantId;d.acceptCharset="utf-8";for(var g in c.items){var f=c.items[g];d.appendChild(c.createHiddenElement("item_name_"+e,f.name));d.appendChild(c.createHiddenElement("item_quantity_"+e,f.quantity));d.appendChild(c.createHiddenElement("item_price_"+e,f.price));d.appendChild(c.createHiddenElement("item_currency_"+e,c.currency));d.appendChild(c.createHiddenElement("item_tax_rate_"+
e,c.taxRate));d.appendChild(c.createHiddenElement("_charset_",""));var i="";for(var h in f)if(typeof f[h]!="function"&&h!="id"&&h!="quantity"&&h!="price")i=i+", "+h+": "+f[h];i=i.substring(1);d.appendChild(c.createHiddenElement("item_description_"+e,i));e++}document.body.appendChild(d);d.submit();document.body.removeChild(d)}};b.emailCheckout=function(){};b.customCheckout=function(){};b.load=function(){var c=this;c.items={};c.total=0;c.quantity=0;if(readCookie("simpleCart"))for(var d=unescape(readCookie("simpleCart")).split("++"),
e=0,g=d.length;e<g;e++){var f=d[e].split("||"),i=new CartItem;if(i.parseValuesFromArray(f)){i.checkQuantityAndPrice();c.items[i.id]=i}}c.isLoaded=true};b.save=function(){var c="";for(var d in this.items)c=c+"++"+this.items[d].print();createCookie("simpleCart",c.substring(2),30)};b.initializeView=function(){var c=this;c.totalOutlets=getElementsByClassName("simpleCart_total");c.quantityOutlets=getElementsByClassName("simpleCart_quantity");c.cartDivs=getElementsByClassName("simpleCart_items");c.taxCostOutlets=
getElementsByClassName("simpleCart_taxCost");c.taxRateOutlets=getElementsByClassName("simpleCart_taxRate");c.shippingCostOutlets=getElementsByClassName("simpleCart_shippingCost");c.finalTotalOutlets=getElementsByClassName("simpleCart_finalTotal");c.addEventToArray(getElementsByClassName("simpleCart_checkout"),simpleCart.checkout,"click");c.addEventToArray(getElementsByClassName("simpleCart_empty"),simpleCart.empty,"click");c.Shelf.readPage();c.pageIsReady=true};b.updateView=function(){b.updateViewTotals();
b.cartDivs&&b.cartDivs.length>0&&b.updateCartView()};b.updateViewTotals=function(){for(var c=[["quantity","none"],["total","currency"],["shippingCost","currency"],["taxCost","currency"],["taxRate","percentage"],["finalTotal","currency"]],d=0,e=c.length;d<e;d++){var g=c[d][0]+"Outlets",f;for(var i in b[g]){switch(c[d][1]){case "none":f=""+b[c[d][0]];break;case "currency":f=b.valueToCurrencyString(b[c[d][0]]);break;case "percentage":f=b.valueToPercentageString(b[c[d][0]]);break;default:f=""+b[c[d][0]];
break}b[g][i].innerHTML=""+f}}};b.updateCartView=function(){var c=[],d,e,g,f,i,h,k,j,l;e=document.createElement("div");for(i in b.cartHeaders){h=document.createElement("div");g=b.cartHeaders[i].split("_");h.innerHTML=g[0];h.className="item"+g[0];d=1;for(xlen=g.length;d<xlen;d++)if(g[d].toLowerCase()=="noheader")h.style.display="none";e.appendChild(h)}e.className="cartHeaders";c[0]=e;d=1;for(f in b.items){e=document.createElement("div");g=b.items[f];for(i in b.cartHeaders){h=document.createElement("div");
k=b.cartHeaders[i].split("_");switch(k[0].toLowerCase()){case "total":j=b.valueToCurrencyString(parseFloat(g.price)*parseInt(g.quantity,10));break;case "increment":j=b.valueToLink("+","javascript:;","onclick=\"simpleCart.items['"+g.id+"'].increment();\"");break;case "decrement":j=b.valueToLink("-","javascript:;","onclick=\"simpleCart.items['"+g.id+"'].decrement();\"");break;case "remove":j=b.valueToLink("Remove","javascript:;","onclick=\"simpleCart.items['"+g.id+"'].remove();\"");break;case "price":j=
b.valueToCurrencyString(g[k[0].toLowerCase()]?g[k[0].toLowerCase()]:" ");break;default:j=g[k[0].toLowerCase()]?g[k[0].toLowerCase()]:" ";break}for(var m=1,n=k.length;m<n;m++){l=k[m].toLowerCase();switch(l){case "image":case "img":j=b.valueToImageString(j);break;case "input":j=b.valueToTextInput(j,"onchange=\"simpleCart.items['"+g.id+"'].set('"+j+"' , this.value);\"");break;case "div":case "span":case "h1":case "h2":case "h3":case "h4":case "p":j=b.valueToElement(l,j,"");break;case "noheader":break;
default:error("unkown header option: "+l);break}}h.innerHTML=j;h.className="item"+k[0];e.appendChild(h)}e.className="itemContainer";c[d]=e;d++}for(f in b.cartDivs){for(d=b.cartDivs[f];d.childNodes[0];)d.removeChild(d.childNodes[0]);e=0;for(i=c.length;e<i;e++)d.appendChild(c[e])}};b.addEventToArray=function(c,d,e){for(var g in c){var f=c[g];if(f.addEventListener)f.addEventListener(e,d,false);else f.attachEvent&&f.attachEvent("on"+e,d)}};b.createHiddenElement=function(c,d){var e=document.createElement("input");
e.type="hidden";e.name=c;e.value=d;return e};b.currencySymbol=function(){switch(b.currency){case JPY:return"&yen;";case EUR:return"&euro;";case GBP:return"&pound;";case USD:case CAD:case AUD:case NZD:case HKD:case SGD:return"&#36;";default:return""}};b.currencyStringForPaypalCheckout=function(c){return b.currencySymbol()=="&#36;"?"$"+parseFloat(c).toFixed(2):""+parseFloat(c).toFixed(2)};b.valueToCurrencyString=function(c){return parseFloat(c).toCurrency(b.currencySymbol())};b.valueToPercentageString=
function(c){return parseFloat(100*c)+"%"};b.valueToImageString=function(c){return c.match(/<\s*img.*src\=/)?c:'<img src="'+c+'" />'};b.valueToTextInput=function(c,d){return'<input type="text" value="'+c+'" '+d+" />"};b.valueToLink=function(c,d,e){return'<a href="'+d+'" '+e+" >"+c+"</a>"};b.valueToElement=function(c,d,e){return"<"+c+" "+e+" > "+d+"</"+c+">"};b.hasItem=function(c){for(var d in b.items){var e=b.items[d],g=true;for(var f in c)if(typeof c[f]!="function"&&f!="quantity"&&f!="id")if(c[f]!=
e[f])g=false;if(g)return d}return false};b.update=function(){simpleCart.isLoaded||simpleCart.load();simpleCart.pageIsReady||simpleCart.initializeView();b.updateTotals();b.updateView();b.save()};b.updateTotals=function(){b.total=0;b.quantity=0;for(var c in b.items){var d=b.items[c];if(d.quantity<1)d.remove();else if(d.quantity!==null&&d.quantity!="undefined")b.quantity=parseInt(b.quantity,10)+parseInt(d.quantity,10);if(d.price)b.total=parseFloat(b.total)+parseInt(d.quantity,10)*parseFloat(d.price)}b.shippingCost=
b.shipping();b.taxCost=parseFloat(b.total)*b.taxRate;b.finalTotal=b.shippingCost+b.taxCost+b.total};b.shipping=function(){if(parseInt(b.quantity,10)===0)return 0;var c=parseFloat(b.shippingFlatRate)+parseFloat(b.shippingTotalRate)*parseFloat(b.total)+parseFloat(b.shippingQuantityRate)*parseInt(b.quantity,10),d,e;for(e in b.items){d=b.items[e];if(d.shipping)c+=typeof d.shipping=="function"?parseFloat(d.shipping()):parseFloat(d.shipping)}return c};b.initialize=function(){simpleCart.initializeView();
simpleCart.load();simpleCart.update()}}function CartItem(){this.id="c"+NextId++}a=CartItem.prototype;
a.set=function(b,c){b=b.toLowerCase();if(typeof this[b]!="function"&&b!="id"){if(b=="quantity"){c=c.replace(/[^(\d|\.)]*/gi,"");c=c.replace(/,*/gi,"");c=parseInt(c,10)}else if(b=="price"){c=c.replace(/[^(\d|\.)]*/gi,"");c=c.replace(/,*/gi,"");c=parseFloat(c)}if(typeof c=="number"&&isNaN(c))error("Improperly formatted input.");else{this[b]=c;this.checkQuantityAndPrice()}}else error("Cannot change "+b+", this is a reserved field.");simpleCart.update()};
a.increment=function(){this.quantity=parseInt(this.quantity,10)+1;simpleCart.update()};a.decrement=function(){if(parseInt(this.quantity,10)<2)this.remove();else{this.quantity=parseInt(this.quantity,10)-1;simpleCart.update()}};a.print=function(){var b="";for(var c in this)if(typeof this[c]!="function")b+=escape(c)+"="+escape(this[c])+"||";return b.substring(0,b.length-2)};
a.checkQuantityAndPrice=function(){if(!this.price||this.quantity==null||this.quantity=="undefined"){this.quantity=1;error("No quantity for item.")}else{this.quantity=(""+this.quantity).replace(/,*/gi,"");this.quantity=parseInt((""+this.quantity).replace(/[^(\d|\.)]*/gi,""),10);if(isNaN(this.quantity)){error("Quantity is not a number.");this.quantity=1}}if(!this.price||this.price==null||this.price=="undefined"){this.price=0;error("No price for item or price not properly formatted.")}else{this.price=
(""+this.price).replace(/,*/gi,"");this.price=parseFloat((""+this.price).replace(/[^(\d|\.)]*/gi,""));if(isNaN(this.price)){error("Price is not a number.");this.price=0}}};a.parseValuesFromArray=function(b){if(b&&b.length&&b.length>0){for(var c=0,d=b.length;c<d;c++){b[c].replace(/||/,"| |");b[c].replace(/\+\+/,"+ +");var e=b[c].split("=");if(e.length>1){if(e.length>2)for(var g=2,f=e.length;g<f;g++)e[1]=e[1]+"="+e[g];this[unescape(e[0]).toLowerCase()]=unescape(e[1])}}return true}else return false};
a.remove=function(){simpleCart.remove(this.id);simpleCart.update()};function Shelf(){this.items={}}Shelf.prototype.readPage=function(){this.items={};var b=getElementsByClassName("simpleCart_shelfItem");for(var c in b){var d=new ShelfItem;this.checkChildren(b[c],d);this.items[d.id]=d}};
Shelf.prototype.checkChildren=function(b,c){for(var d=0;b.childNodes[d];d++){var e=b.childNodes[d];if(e.className&&e.className.match(/item_[^ ]+/)){var g=/item_[^ ]+/.exec(e.className)[0].split("_");if(g[1]=="add"||g[1]=="Add"){g=[];g.push(e);var f=simpleCart.Shelf.addToCart(c.id);simpleCart.addEventToArray(g,f,"click");e.id=c.id}else c[g[1]]=e}e.childNodes[0]&&this.checkChildren(e,c)}};Shelf.prototype.empty=function(){this.items={}};
Shelf.prototype.addToCart=function(b){return function(){simpleCart.Shelf.items[b]?simpleCart.Shelf.items[b].addToCart():error("Shelf item with id of "+b+" does not exist.")}};function ShelfItem(){this.id="s"+NextId++}ShelfItem.prototype.remove=function(){simpleCart.Shelf.items[this.id]=null};
ShelfItem.prototype.addToCart=function(){var b=[],c;for(var d in this)if(typeof this[d]!="function"&&d!="id"){c="";switch(d){case "price":if(this[d].value)c=this[d].value;else if(this[d].innerHTML)c=this[d].innerHTML;c=c.replace(/[^(\d|\.)]*/gi,"");c=c.replace(/,*/,"");break;case "image":c=this[d].src;break;default:c=this[d].value?this[d].value:this[d].innerHTML?this[d].innerHTML:this[d].src?this[d].src:this[d];break}b.push(d+"="+c)}simpleCart.add(b)};
function createCookie(b,c,d){if(d){var e=new Date;e.setTime(e.getTime()+d*24*60*60*1E3);d="; expires="+e.toGMTString()}else d="";document.cookie=b+"="+c+d+"; path=/"}function readCookie(b){b=b+"=";for(var c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];e.charAt(0)==" ";)e=e.substring(1,e.length);if(e.indexOf(b)===0)return e.substring(b.length,e.length)}return null}function eraseCookie(b){createCookie(b,"",-1)}
function getElementsByClassName(b,c,d){getElementsByClassName=document.getElementsByClassName?function(e,g,f){f=f||document;e=f.getElementsByClassName(e);g=g?new RegExp("\\b"+g+"\\b","i"):null;f=[];for(var i,h=0,k=e.length;h<k;h+=1){i=e[h];if(!g||g.test(i.nodeName))f.push(i)}return f}:document.evaluate?function(e,g,f){g=g||"*";f=f||document;e=e.split(" ");var i="",h="http://www.w3.org/1999/xhtml",k=document.documentElement.namespaceURI===h?h:null;h=[];for(var j,l=0,m=e.length;l<m;l+=1)i+="[contains(concat(' ', @class, ' '), ' "+
e[l]+" ')]";try{j=document.evaluate(".//"+g+i,f,k,0,null)}catch(n){j=document.evaluate(".//"+g+i,f,null,0,null)}for(;g=j.iterateNext();)h.push(g);return h}:function(e,g,f){g=g||"*";f=f||document;var i=e.split(" ");e=[];g=g==="*"&&f.all?f.all:f.getElementsByTagName(g);f=[];var h;h=0;for(var k=i.length;h<k;h+=1)e.push(new RegExp("(^|\\s)"+i[h]+"(\\s|$)"));k=0;for(var j=g.length;k<j;k+=1){i=g[k];h=false;for(var l=0,m=e.length;l<m;l+=1){h=e[l].test(i.className);if(!h)break}h&&f.push(i)}return f};return getElementsByClassName(b,
c,d)}String.prototype.reverse=function(){return this.split("").reverse().join("")};Number.prototype.withCommas=function(){for(var b=6,c=parseFloat(this).toFixed(2).toString().reverse();b<c.length;){c=c.substring(0,b)+","+c.substring(b);b+=4}return c.reverse()};Number.prototype.toCurrency=function(b){return(b?b:"$")+this.withCommas()};function error(b){try{console.log(b)}catch(c){}}var simpleCart=new Cart;
if(typeof jQuery!=="undefined")$(document).ready(function(){simpleCart.initialize()});else if(typeof Prototype!=="undefined")Event.observe(window,"load",function(){simpleCart.initialize()});else window.onload=simpleCart.initialize;